import React, { useState, useEffect, Suspense } from "react";
import { Link, useSearchParams } from "react-router-dom";
import { useAuthStore } from "../../store/authStore";
import { useAstrologyStore } from "../../store/astrologyStore";
import DashboardLayout from "../../components/layout/DashboardLayout";
import OnboardingTour from "../../components/dashboard/OnboardingTour";
import PersonalizationPanel from "../../components/dashboard/PersonalizationPanel";
import LoadingSkeleton from "../../components/dashboard/LoadingSkeleton";
import { templateManagementService } from "../../services/templateManagementService";
import {
  Star,
  FileText,
  Users,
  TrendingUp,
  Plus,
  ArrowRight,
  Crown,
  Zap,
  Calendar,
  BarChart3,
  Clock,
  Target,
  Sparkles,
  Sun,
  Moon,
  Heart,
  BookOpen,
  Activity,
  Award,
  Eye,
  Download,
} from "lucide-react";
import Button from "../../components/ui/Button";

const DashboardPage: React.FC = () => {
  const { user } = useAuthStore();
  const {
    birthCharts,
    reports,
    compatibilityReports,
    reportTemplates,
    templateCategories,
    loading,
    fetchBirthCharts,
    fetchReports,
    fetchCompatibilityReports,
    fetchReportTemplates,
    fetchTemplateCategories,
    createNatalChartReport,
    createVedicReport,
  } = useAstrologyStore();

  const [searchParams] = useSearchParams();
  const [showOnboarding, setShowOnboarding] = useState(false);
  const [showPersonalization, setShowPersonalization] = useState(false);
  const [isNewUser, setIsNewUser] = useState(false);
  const [dashboardLoading, setDashboardLoading] = useState(true);
  const [isGeneratingReport, setIsGeneratingReport] = useState<string | null>(
    null,
  );
  const [isGeneratingTemplate, setIsGeneratingTemplate] = useState(false);

  const activeTab = searchParams.get("tab") || "overview";
  const userDisplayName = user?.name || user?.email?.split("@")[0] || "Seeker";

  useEffect(() => {
    if (user) {
      // Fetch real data from database only once
      const fetchData = async () => {
        try {
          await Promise.all([
            fetchBirthCharts(user.id),
            fetchReports(user.id),
            fetchCompatibilityReports(user.id),
            // Also fetch templates for the dashboard
            fetchReportTemplates({ isPublic: true }),
            fetchTemplateCategories(),
          ]);
        } catch (error) {
          console.error("Error fetching dashboard data:", error);
        }
      };

      fetchData();

      // Check for new user onboarding
      const hasSeenOnboarding = localStorage.getItem(
        `onboarding-seen-${user.id}`,
      );
      if (!hasSeenOnboarding) {
        setIsNewUser(true);
        const timer = setTimeout(() => {
          setShowOnboarding(true);
        }, 2000);
        return () => clearTimeout(timer);
      }
    }
  }, [user?.id]); // Only depend on user.id to prevent excessive reloads

  useEffect(() => {
    const timer = setTimeout(() => {
      setDashboardLoading(false);
    }, 1000);
    return () => clearTimeout(timer);
  }, []);

  const handleOnboardingComplete = () => {
    if (user) {
      localStorage.setItem(`onboarding-seen-${user.id}`, "true");
      setIsNewUser(false);
    }
  };

  const handleGenerateReport = async (
    chartId: string,
    reportType: "natal" | "vedic",
    isPremium: boolean = false,
  ) => {
    setIsGeneratingReport(`${reportType}-${chartId}`);
    try {
      if (reportType === "natal") {
        await createNatalChartReport(chartId, isPremium);
      } else if (reportType === "vedic") {
        await createVedicReport(chartId, isPremium);
      }
      if (user) {
        await fetchReports(user.id);
      }
    } catch (error) {
      console.error("Error generating report:", error);
    } finally {
      setIsGeneratingReport(null);
    }
  };

  // Quick stats for dashboard overview
  const quickStats = [
    {
      label: "Birth Charts",
      value: birthCharts?.length || 0,
      icon: Star,
      color: "from-purple-600 to-indigo-600",
      link: "/astrology/birth-chart",
      description: "Personal cosmic blueprints",
    },
    {
      label: "Reports Generated",
      value: reports?.length || 0,
      icon: FileText,
      color: "from-teal-600 to-cyan-600",
      link: "/astrology/reports",
      description: "Professional astrology reports",
    },
    {
      label: "Compatibility Reports",
      value: compatibilityReports?.length || 0,
      icon: Users,
      color: "from-pink-600 to-rose-600",
      link: "/astrology/compatibility",
      description: "Relationship analysis",
    },
    {
      label: "Reading Time",
      value: `${Math.round((reports?.length || 0) * 8.5)}m`,
      icon: Clock,
      color: "from-amber-600 to-orange-600",
      link: "/astrology/reports",
      description: "Total content consumed",
    },
  ];

  // Quick actions for easy access
  const quickActions = [
    {
      title: "Create Birth Chart",
      description: "Generate your cosmic blueprint",
      icon: Star,
      link: "/astrology/birth-chart",
      color: "from-purple-600 to-pink-600",
      priority: true,
    },
    {
      title: "Generate Report",
      description: "Create detailed astrology report",
      icon: FileText,
      link: "/astrology/reports",
      color: "from-teal-600 to-cyan-600",
      priority: true,
    },
    {
      title: "Check Compatibility",
      description: "Analyze relationship dynamics",
      icon: Heart,
      link: "/astrology/compatibility",
      color: "from-pink-600 to-rose-600",
      priority: false,
    },
    {
      title: "Transit Reports",
      description: "Current planetary influences",
      icon: TrendingUp,
      link: "/astrology/transits",
      color: "from-green-600 to-teal-600",
      priority: false,
    },
  ];

  if (dashboardLoading) {
    return (
      <DashboardLayout>
        <div className="p-6 space-y-6">
          <LoadingSkeleton variant="header" className="mb-8" />
          <LoadingSkeleton variant="stats" className="mb-8" />
          <LoadingSkeleton variant="card" count={2} />
        </div>
      </DashboardLayout>
    );
  }

  return (
    <DashboardLayout>
      <div className="p-4 sm:p-6 space-y-6">
        {/* Welcome Section */}
        <div className="bg-gradient-to-r from-slate-800/50 to-slate-700/50 backdrop-blur-sm rounded-2xl p-6 sm:p-8 border border-slate-700/50">
          <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between">
            <div className="mb-4 sm:mb-0">
              <div className="flex items-center space-x-2 mb-2">
                <Sparkles className="w-5 h-5 text-purple-400" />
                <span className="text-purple-400 font-medium text-sm uppercase tracking-wide">
                  {user?.isPremium ? "Premium" : "Free"} Dashboard
                </span>
                {user?.isPremium && (
                  <Crown className="w-4 h-4 text-amber-400" />
                )}
                {isNewUser && (
                  <span className="bg-green-500/20 text-green-400 text-xs px-2 py-1 rounded-full animate-pulse">
                    New!
                  </span>
                )}
              </div>
              <h1 className="text-2xl sm:text-3xl font-bold text-white mb-2">
                Welcome back, {userDisplayName}!
              </h1>
              <p className="text-slate-300">
                Your cosmic journey continues. Explore the mysteries of the
                universe.
              </p>
            </div>
            <div className="flex items-center space-x-3">
              {isNewUser && (
                <Button
                  onClick={() => setShowOnboarding(true)}
                  variant="outline"
                  size="sm"
                  className="border-purple-500/50 text-purple-400 hover:bg-purple-500/10"
                >
                  Take Tour
                </Button>
              )}
              <div className="w-16 h-16 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center relative">
                <Star className="w-6 h-6 text-white" />
                <div className="absolute -top-1 -right-1 w-4 h-4 bg-gradient-to-br from-amber-400 to-orange-400 rounded-full flex items-center justify-center">
                  <Sparkles className="w-2 h-2 text-white" />
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Welcome Journey Section - Moved to top after welcome header */}
        {(birthCharts?.length === 0 || !birthCharts) &&
          (reports?.length === 0 || !reports) && (
            <div className="bg-gradient-to-br from-purple-900/30 to-indigo-900/30 rounded-2xl p-8 border border-purple-500/20 text-center mb-6">
              <div className="w-16 h-16 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <Star className="w-8 h-8 text-white" />
              </div>
              <h3 className="text-xl font-bold text-white mb-2">
                Welcome to Your Astrology Journey
              </h3>
              <p className="text-slate-400 mb-6 max-w-md mx-auto">
                Start by creating your first birth chart to unlock personalized
                astrology reports and cosmic insights.
              </p>
              <div className="flex flex-col sm:flex-row gap-3 justify-center">
                <Link to="/astrology/birth-chart">
                  <Button className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700">
                    <Plus className="w-4 h-4 mr-2" />
                    Create Birth Chart
                  </Button>
                </Link>
                <Button
                  onClick={() => setShowOnboarding(true)}
                  variant="outline"
                  className="border-slate-600 text-slate-300 hover:bg-slate-700/50"
                >
                  Take a Tour
                </Button>
              </div>
            </div>
          )}

        {/* Quick Stats */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          {quickStats.map((stat, index) => {
            const Icon = stat.icon;
            return (
              <Link key={index} to={stat.link} className="block group">
                <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50 hover:border-slate-600/50 transition-all duration-200 group-hover:scale-105">
                  <div className="flex items-center justify-between mb-4">
                    <div
                      className={`w-12 h-12 bg-gradient-to-br ${stat.color} rounded-lg flex items-center justify-center`}
                    >
                      <Icon className="w-6 h-6 text-white" />
                    </div>
                    <ArrowRight className="w-4 h-4 text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity" />
                  </div>
                  <div className="space-y-1">
                    <p className="text-2xl font-bold text-white">
                      {stat.value}
                    </p>
                    <p className="text-sm font-medium text-slate-300">
                      {stat.label}
                    </p>
                    <p className="text-xs text-slate-400">{stat.description}</p>
                  </div>
                </div>
              </Link>
            );
          })}
        </div>

        {/* Quick Actions */}
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <h2 className="text-xl font-bold text-white">Quick Actions</h2>
            <Link to="/astrology/reports">
              <Button
                variant="ghost"
                size="sm"
                className="text-purple-400 hover:text-purple-300"
              >
                View All <ArrowRight className="w-4 h-4 ml-1" />
              </Button>
            </Link>
          </div>
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            {quickActions.map((action, index) => {
              const Icon = action.icon;
              return (
                <Link key={index} to={action.link} className="block group">
                  <div
                    className={`bg-gradient-to-br ${action.color} p-6 rounded-xl text-white hover:scale-105 transition-transform duration-200 ${action.priority ? "ring-2 ring-purple-500/30" : ""}`}
                  >
                    <Icon className="w-8 h-8 mb-3" />
                    <h3 className="font-semibold mb-1">{action.title}</h3>
                    <p className="text-sm opacity-90">{action.description}</p>
                    {action.priority && (
                      <div className="mt-2">
                        <span className="text-xs bg-white/20 px-2 py-1 rounded-full">
                          Recommended
                        </span>
                      </div>
                    )}
                  </div>
                </Link>
              );
            })}
          </div>
        </div>

        {/* Astrological Templates Section */}
        <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700/50">
          <div className="flex items-center justify-between mb-6">
            <div className="flex items-center space-x-3">
              <Sparkles className="w-6 h-6 text-purple-400" />
              <h2 className="text-xl font-bold text-white">
                Astrological Report Templates
              </h2>
            </div>
            <Link to="/astrology/reports">
              <Button variant="ghost" size="sm" icon={Eye}>
                Create Reports
              </Button>
            </Link>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {/* Western Astrology Template */}
            <div className="block group">
              <div className="bg-gradient-to-br from-blue-900/30 to-indigo-900/30 rounded-xl p-6 border border-blue-500/20 hover:border-blue-400/40 transition-all duration-200 group-hover:scale-105">
                <div className="flex items-center mb-4">
                  <div className="w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center">
                    <Star className="w-6 h-6 text-white" />
                  </div>
                  <div className="ml-3">
                    <h3 className="text-white font-semibold">
                      Western Astrology
                    </h3>
                    <p className="text-blue-200 text-sm">
                      Tropical zodiac system
                    </p>
                  </div>
                </div>
                <p className="text-blue-100 text-sm mb-4">
                  Complete natal chart analysis with planetary positions,
                  houses, and aspects.
                </p>
                <div className="flex items-center justify-between">
                  <span className="text-xs bg-blue-600/20 text-blue-300 px-2 py-1 rounded-full">
                    Popular
                  </span>
                  <div className="flex space-x-2">
                    <button
                      onClick={async () => {
                        if (!user) return;
                        setIsGeneratingTemplate(true);
                        try {
                          await templateManagementService.generateAITemplate(
                            "AI Western Natal Chart",
                            "western",
                            "natal",
                            user.id,
                          );
                          // Refresh templates
                          if (fetchReportTemplates) {
                            await fetchReportTemplates({ isPublic: true });
                          }
                        } catch (error) {
                          console.error("Error generating template:", error);
                        } finally {
                          setIsGeneratingTemplate(false);
                        }
                      }}
                      disabled={isGeneratingTemplate}
                      className="text-xs bg-purple-600/20 text-purple-300 px-2 py-1 rounded-full hover:bg-purple-600/30"
                    >
                      {isGeneratingTemplate ? "Generating..." : "Generate AI"}
                    </button>
                    <Link to="/astrology/reports?template=western">
                      <ArrowRight className="w-4 h-4 text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity" />
                    </Link>
                  </div>
                </div>
              </div>
            </div>

            {/* Vedic Astrology Template */}
            <Link
              to="/astrology/reports?template=vedic"
              className="block group"
            >
              <div className="bg-gradient-to-br from-orange-900/30 to-red-900/30 rounded-xl p-6 border border-orange-500/20 hover:border-orange-400/40 transition-all duration-200 group-hover:scale-105">
                <div className="flex items-center mb-4">
                  <div className="w-12 h-12 bg-gradient-to-br from-orange-600 to-red-600 rounded-lg flex items-center justify-center">
                    <Moon className="w-6 h-6 text-white" />
                  </div>
                  <div className="ml-3">
                    <h3 className="text-white font-semibold">
                      Vedic Astrology
                    </h3>
                    <p className="text-orange-200 text-sm">
                      Sidereal zodiac system
                    </p>
                  </div>
                </div>
                <p className="text-orange-100 text-sm mb-4">
                  Traditional Jyotish analysis with Nakshatras, Dashas, and
                  spiritual insights.
                </p>
                <div className="flex items-center justify-between">
                  <span className="text-xs bg-orange-600/20 text-orange-300 px-2 py-1 rounded-full">
                    Traditional
                  </span>
                  <ArrowRight className="w-4 h-4 text-orange-400 opacity-0 group-hover:opacity-100 transition-opacity" />
                </div>
              </div>
            </Link>

            {/* Transit Reports Template */}
            <Link to="/astrology/transits" className="block group">
              <div className="bg-gradient-to-br from-green-900/30 to-teal-900/30 rounded-xl p-6 border border-green-500/20 hover:border-green-400/40 transition-all duration-200 group-hover:scale-105">
                <div className="flex items-center mb-4">
                  <div className="w-12 h-12 bg-gradient-to-br from-green-600 to-teal-600 rounded-lg flex items-center justify-center">
                    <TrendingUp className="w-6 h-6 text-white" />
                  </div>
                  <div className="ml-3">
                    <h3 className="text-white font-semibold">
                      Transit Reports
                    </h3>
                    <p className="text-green-200 text-sm">Current influences</p>
                  </div>
                </div>
                <p className="text-green-100 text-sm mb-4">
                  Analyze current planetary movements and their impact on your
                  natal chart.
                </p>
                <div className="flex items-center justify-between">
                  <span className="text-xs bg-green-600/20 text-green-300 px-2 py-1 rounded-full">
                    Predictive
                  </span>
                  <ArrowRight className="w-4 h-4 text-green-400 opacity-0 group-hover:opacity-100 transition-opacity" />
                </div>
              </div>
            </Link>

            {/* Chinese Astrology Template */}
            <Link
              to="/astrology/reports?template=chinese"
              className="block group"
            >
              <div className="bg-gradient-to-br from-red-900/30 to-pink-900/30 rounded-xl p-6 border border-red-500/20 hover:border-red-400/40 transition-all duration-200 group-hover:scale-105">
                <div className="flex items-center mb-4">
                  <div className="w-12 h-12 bg-gradient-to-br from-red-600 to-pink-600 rounded-lg flex items-center justify-center">
                    <Zap className="w-6 h-6 text-white" />
                  </div>
                  <div className="ml-3">
                    <h3 className="text-white font-semibold">
                      Chinese Astrology
                    </h3>
                    <p className="text-red-200 text-sm">Four Pillars system</p>
                  </div>
                </div>
                <p className="text-red-100 text-sm mb-4">
                  Ancient Chinese wisdom with animal signs, elements, and life
                  cycles.
                </p>
                <div className="flex items-center justify-between">
                  <span className="text-xs bg-red-600/20 text-red-300 px-2 py-1 rounded-full">
                    Ancient
                  </span>
                  <ArrowRight className="w-4 h-4 text-red-400 opacity-0 group-hover:opacity-100 transition-opacity" />
                </div>
              </div>
            </Link>

            {/* Compatibility Template */}
            <Link to="/astrology/compatibility" className="block group">
              <div className="bg-gradient-to-br from-pink-900/30 to-rose-900/30 rounded-xl p-6 border border-pink-500/20 hover:border-pink-400/40 transition-all duration-200 group-hover:scale-105">
                <div className="flex items-center mb-4">
                  <div className="w-12 h-12 bg-gradient-to-br from-pink-600 to-rose-600 rounded-lg flex items-center justify-center">
                    <Heart className="w-6 h-6 text-white" />
                  </div>
                  <div className="ml-3">
                    <h3 className="text-white font-semibold">Compatibility</h3>
                    <p className="text-pink-200 text-sm">
                      Relationship analysis
                    </p>
                  </div>
                </div>
                <p className="text-pink-100 text-sm mb-4">
                  Explore relationship dynamics and compatibility between two
                  people.
                </p>
                <div className="flex items-center justify-between">
                  <span className="text-xs bg-pink-600/20 text-pink-300 px-2 py-1 rounded-full">
                    Synastry
                  </span>
                  <ArrowRight className="w-4 h-4 text-pink-400 opacity-0 group-hover:opacity-100 transition-opacity" />
                </div>
              </div>
            </Link>

            {/* Premium Templates */}
            <Link to="/astrology/reports?premium=true" className="block group">
              <div className="bg-gradient-to-br from-amber-900/30 to-yellow-900/30 rounded-xl p-6 border border-amber-500/20 hover:border-amber-400/40 transition-all duration-200 group-hover:scale-105">
                <div className="flex items-center mb-4">
                  <div className="w-12 h-12 bg-gradient-to-br from-amber-600 to-yellow-600 rounded-lg flex items-center justify-center">
                    <Crown className="w-6 h-6 text-white" />
                  </div>
                  <div className="ml-3">
                    <h3 className="text-white font-semibold">
                      Premium Templates
                    </h3>
                    <p className="text-amber-200 text-sm">Enhanced features</p>
                  </div>
                </div>
                <p className="text-amber-100 text-sm mb-4">
                  Access advanced templates with detailed analysis and premium
                  features.
                </p>
                <div className="flex items-center justify-between">
                  <span className="text-xs bg-amber-600/20 text-amber-300 px-2 py-1 rounded-full">
                    Premium
                  </span>
                  <ArrowRight className="w-4 h-4 text-amber-400 opacity-0 group-hover:opacity-100 transition-opacity" />
                </div>
              </div>
            </Link>
          </div>
        </div>

        {/* Recent Reports */}
        {reports.length > 0 && (
          <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700/50">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-xl font-bold text-white">Recent Reports</h2>
              <Link to="/astrology/reports">
                <Button variant="ghost" size="sm">
                  View All <ArrowRight className="w-4 h-4 ml-1" />
                </Button>
              </Link>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {reports.slice(0, 6).map((report) => (
                <div
                  key={report.id}
                  className="bg-slate-700/30 rounded-xl p-4 border border-slate-600/30 hover:border-slate-500/50 transition-colors"
                >
                  <div className="flex items-start justify-between mb-3">
                    <div className="flex items-center space-x-2">
                      <FileText className="w-5 h-5 text-teal-400" />
                      {report.is_premium && (
                        <Crown className="w-4 h-4 text-amber-400" />
                      )}
                    </div>
                    <span className="text-xs text-slate-400">
                      {new Date(report.created_at).toLocaleDateString()}
                    </span>
                  </div>
                  <h4 className="text-white font-medium mb-2 line-clamp-2">
                    {report.title}
                  </h4>
                  <p className="text-slate-400 text-sm mb-3 line-clamp-2">
                    {report.content?.substring(0, 100)}...
                  </p>
                  <div className="flex items-center justify-between">
                    <span className="text-xs bg-slate-600/50 text-slate-300 px-2 py-1 rounded-full">
                      {report.report_type
                        .replace(/-/g, " ")
                        .replace(/\b\w/g, (l) => l.toUpperCase())}
                    </span>
                    <div className="flex items-center space-x-2">
                      <Link to={`/astrology/reports?view=${report.id}`}>
                        <button className="p-1.5 text-slate-400 hover:text-white hover:bg-slate-600/50 rounded-lg transition-colors">
                          <Eye className="w-4 h-4" />
                        </button>
                      </Link>
                      <Link
                        to={`/astrology/reports?view=${report.id}&export=pdf`}
                      >
                        <button className="p-1.5 text-slate-400 hover:text-white hover:bg-slate-600/50 rounded-lg transition-colors">
                          <Download className="w-4 h-4" />
                        </button>
                      </Link>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Welcome Journey Section - Removed from here as it's now at the top */}

        {/* Today's Cosmic Energy */}
        <div className="bg-gradient-to-br from-purple-900/30 to-indigo-900/30 rounded-2xl p-6 border border-purple-500/20">
          <div className="flex items-center space-x-3 mb-4">
            <Zap className="w-6 h-6 text-purple-400" />
            <h2 className="text-xl font-bold text-white">
              Today's Cosmic Energy
            </h2>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div className="text-center">
              <Sun className="w-8 h-8 text-amber-400 mx-auto mb-2" />
              <h4 className="text-white font-medium mb-1">Solar Influence</h4>
              <p className="text-slate-300 text-sm">
                High energy for new beginnings and creative projects
              </p>
            </div>
            <div className="text-center">
              <Moon className="w-8 h-8 text-blue-400 mx-auto mb-2" />
              <h4 className="text-white font-medium mb-1">Lunar Phase</h4>
              <p className="text-slate-300 text-sm">
                Waxing moon supports growth and manifestation
              </p>
            </div>
            <div className="text-center">
              <Target className="w-8 h-8 text-green-400 mx-auto mb-2" />
              <h4 className="text-white font-medium mb-1">Focus Areas</h4>
              <p className="text-slate-300 text-sm">
                Relationships, career decisions, spiritual growth
              </p>
            </div>
          </div>
        </div>
      </div>

      {/* Onboarding Tour */}
      <OnboardingTour
        isOpen={showOnboarding}
        onClose={() => setShowOnboarding(false)}
        onComplete={handleOnboardingComplete}
      />

      {/* Personalization Panel */}
      <PersonalizationPanel
        isOpen={showPersonalization}
        onClose={() => setShowPersonalization(false)}
      />
    </DashboardLayout>
  );
};

export default DashboardPage;
